
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Maps &#8212; gammapy vX.Y.Z</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css?v=995e94df" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.min.css?v=21c0b90a" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=bf3cbe73" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=23d6972c"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/api/maps';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.gammapy.org/stable/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Mask maps" href="mask_maps.html" />
    <link rel="prev" title="Makers - Data reduction" href="makers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="02 Apr 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/gammapy_logo_nav.png" class="logo__image only-light" alt="gammapy vX.Y.Z - Home"/>
    <script>document.write(`<img src="../../_static/gammapy_logo_nav.png" class="logo__image only-dark" alt="gammapy vX.Y.Z - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting-started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user-guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api-reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../development/index.html">
                        Developer guide
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../release-notes/index.html">
                        Release notes
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/gammapyST" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-slack fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting-started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user-guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api-reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../development/index.html">
                        Developer guide
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../release-notes/index.html">
                        Release notes
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/gammapyST" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-slack fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../starting/analysis_1.html">High level interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting/analysis_2.html">Low level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting/overview.html">Data structures</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data/cta.html">CTA with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/fermi_lat.html">Fermi-LAT with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/hawc.html">HAWC with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/hess.html">H.E.S.S. with Gammapy</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/cta_sensitivity.html">Point source sensitivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/extended_source_spectral_analysis.html">Spectral analysis of extended sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/sed_fitting.html">Flux point fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectral_analysis.html">Spectral analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectral_analysis_hli.html">Spectral analysis with the HLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectral_analysis_rad_max.html">Spectral analysis with energy-dependent directional cuts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectrum_simulation.html">1D spectrum simulation</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/detect.html">Source detection and significance maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/modeling_2D.html">2D map fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/ring_background.html">Ring background map</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/analysis_3d.html">3D detailed analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/analysis_mwl.html">Multi instrument joint 3D and 1D analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/cta_data_analysis.html">Basic image exploration and fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/energy_dependent_estimation.html">Morphological energy dependence estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/event_sampling.html">Event sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/event_sampling_nrg_depend_models.html">Sample a source with energy-dependent temporal evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/flux_profiles.html">Flux Profile Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-3d/simulate_3d.html">3D map simulation</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/Variability_estimation.html">Estimation of time variability in a lightcurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve.html">Light curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve_flare.html">Light curves for flares</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve_simulation.html">Simulating and fitting a time varying source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/pulsar_analysis.html">Pulsar analysis</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="astro_dark_matter.html">Dark matter spatial and spectral models</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Source catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets.html">Datasets - Reduced data, IRFs, models</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitting.html">Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="irfs.html">Using Gammapy IRFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="makers.html">Makers - Data reduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="mask_maps.html">Mask maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_management.html">Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="observation_clustering.html">Observational clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="priors.html">Priors</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../scripts/survey_map.html">Survey Map Script</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Maps</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-tutorials-api-maps-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="maps">
<span id="sphx-glr-tutorials-api-maps-py"></span><h1>Maps<a class="headerlink" href="#maps" title="Link to this heading">#</a></h1>
<p>A thorough tutorial to work with WCS maps.</p>
<figure class="align-default" id="id1">
<img alt="Gammapy Maps Illustration" src="../../_images/gammapy_maps.png" />
<figcaption>
<p><span class="caption-text">Gammapy Maps Illustration</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="../../api-reference/maps.html#module-gammapy.maps" title="gammapy.maps"><code class="xref py py-obj docutils literal notranslate"><span class="pre">maps</span></code></a> submodule contains classes for representing
pixilised data on the sky with an arbitrary number of non-spatial
dimensions such as energy, time, event class or any possible
user-defined dimension (illustrated in the image above). The main
<code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code> data structure features a uniform API for
<a class="reference external" href="https://fits.gsfc.nasa.gov/fits_wcs.html">WCS</a> as well as
<a class="reference external" href="https://en.wikipedia.org/wiki/HEALPix">HEALPix</a> based images. The
API also generalizes simple image based operations such as smoothing,
interpolation and reprojection to the arbitrary extra dimensions and
makes working with (2 + N)-dimensional hypercubes as easy as working
with a simple 2D image. Further information is also provided on the
<a class="reference internal" href="../../api-reference/maps.html#module-gammapy.maps" title="gammapy.maps"><code class="xref py py-obj docutils literal notranslate"><span class="pre">maps</span></code></a> docs page.</p>
<p>In the following introduction we will learn all the basics of working
with WCS based maps. HEALPix based maps will be covered in a future
tutorial. Make sure you have worked through the <a class="reference internal" href="../starting/overview.html"><span class="doc">Gammapy
overview</span></a>, because a solid knowledge
about working with <code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyCoord</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code> objects as well as
<a class="reference external" href="http://www.numpy.org/">Numpy</a> is required for this tutorial.</p>
<p>This notebook is rather lengthy, but getting to know the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code> data
structure in detail is essential for working with Gammapy and will allow
you to fulfill complex analysis tasks with very few and simple code in
future!</p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># %matplotlib inline</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">convolve</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">EventList</span>
<span class="kn">from</span> <span class="nn">gammapy.maps</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">LabelMapAxis</span><span class="p">,</span>
    <span class="n">Map</span><span class="p">,</span>
    <span class="n">MapAxes</span><span class="p">,</span>
    <span class="n">MapAxis</span><span class="p">,</span>
    <span class="n">TimeMapAxis</span><span class="p">,</span>
    <span class="n">WcsGeom</span><span class="p">,</span>
    <span class="n">WcsNDMap</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-setup">
<h2>Check setup<a class="headerlink" href="#check-setup" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.utils.check</span> <span class="kn">import</span> <span class="n">check_tutorials_setup</span>

<span class="n">check_tutorials_setup</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>System:

        python_executable      : /home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/bin/python
        python_version         : 3.9.18
        machine                : x86_64
        system                 : Linux


Gammapy package:

        version                : 1.2.dev2111+g5675db08b.d20240402
        path                   : /home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/gammapy


Other packages:

        numpy                  : 1.26.4
        scipy                  : 1.12.0
        astropy                : 5.2.2
        regions                : 0.8
        click                  : 8.1.7
        yaml                   : 6.0.1
        IPython                : 8.18.1
        jupyterlab             : not installed
        matplotlib             : 3.8.3
        pandas                 : not installed
        healpy                 : 1.16.6
        iminuit                : 2.25.2
        sherpa                 : 4.16.0
        naima                  : 0.10.0
        emcee                  : 3.1.4
        corner                 : 2.2.2
        ray                    : 2.10.0


Gammapy environment variables:

        GAMMAPY_DATA           : ./gammapy-data
</pre></div>
</div>
</section>
<section id="creating-wcs-maps">
<h2>Creating WCS Maps<a class="headerlink" href="#creating-wcs-maps" title="Link to this heading">#</a></h2>
<section id="using-factory-methods">
<h3>Using Factory Methods<a class="headerlink" href="#using-factory-methods" title="Link to this heading">#</a></h3>
<p>Maps are most easily created using the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.create" title="gammapy.maps.Map.create"><code class="xref py py-obj docutils literal notranslate"><span class="pre">create</span></code></a>
factory method:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_allsky</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre></div>
</div>
<p>Calling <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.create" title="gammapy.maps.Map.create"><code class="xref py py-obj docutils literal notranslate"><span class="pre">create</span></code></a> without any further arguments creates by
default an allsky WCS map using a CAR projection, ICRS coordinates and a
pixel size of 1 deg. This can be easily checked by printing the
<a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.geom" title="gammapy.maps.Map.geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">geom</span></code></a> attribute of the map:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_allsky</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>WcsGeom

        axes       : [&#39;lon&#39;, &#39;lat&#39;]
        shape      : (3600, 1800)
        ndim       : 2
        frame      : icrs
        projection : CAR
        center     : 0.0 deg, 0.0 deg
        width      : 360.0 deg x 180.0 deg
        wcs ref    : 0.0 deg, 0.0 deg
</pre></div>
</div>
<p>The <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.geom" title="gammapy.maps.Map.geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">geom</span></code></a> attribute is a <a class="reference internal" href="../../api/gammapy.maps.Geom.html#gammapy.maps.Geom" title="gammapy.maps.Geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Geom</span></code></a> object, that defines the basic
geometry of the map, such as size of the pixels, width and height of the
image, coordinate system etc., but we will learn more about this object
later.</p>
<p>Besides the <code class="docutils literal notranslate"><span class="pre">.geom</span></code> attribute the map has also a <code class="docutils literal notranslate"><span class="pre">.data</span></code> attribute,
which is just a plain <code class="docutils literal notranslate"><span class="pre">~numpy.ndarray</span></code> and stores the data associated
with this map:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_allsky</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 ...
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]]
</pre></div>
</div>
<p>By default maps are filled with zeros.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">map_type</span></code> argument can be used to control the pixelization scheme
(WCS or HPX).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">position</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>

<span class="c1"># Create a WCS Map</span>
<span class="n">m_wcs</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;wcs&quot;</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># Create a HPX Map</span>
<span class="n">m_hpx</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;hpx&quot;</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an example that creates a WCS map centered on the Galactic
center and now uses Galactic coordinates:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">m_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">skydir</span><span class="o">=</span><span class="n">skydir</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;TAN&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>WcsGeom

        axes       : [&#39;lon&#39;, &#39;lat&#39;]
        shape      : (500, 250)
        ndim       : 2
        frame      : galactic
        projection : TAN
        center     : 0.0 deg, 0.0 deg
        width      : 10.0 deg x 5.0 deg
        wcs ref    : 0.0 deg, 0.0 deg
</pre></div>
</div>
<p>In addition we have defined a TAN projection, a pixel size of <code class="docutils literal notranslate"><span class="pre">0.02</span></code>
deg and a width of the map of <code class="docutils literal notranslate"><span class="pre">10</span> <span class="pre">deg</span> <span class="pre">x</span> <span class="pre">5</span> <span class="pre">deg</span></code>. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">width</span></code> argument
also takes scalar value instead of a tuple, which is interpreted as both
the width and height of the map, so that a quadratic map is created.</p>
</section>
<section id="creating-from-a-map-geometry">
<h3>Creating from a Map Geometry<a class="headerlink" href="#creating-from-a-map-geometry" title="Link to this heading">#</a></h3>
<p>As we have seen in the first examples, the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> object couples the
data (stored as a <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ndarray</span></code></a>) with a <a class="reference internal" href="../../api/gammapy.maps.Geom.html#gammapy.maps.Geom" title="gammapy.maps.Geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Geom</span></code></a> object. The
<code class="xref py py-obj docutils literal notranslate"><span class="pre">~Geom</span></code> object can be seen as a generalization of an
<a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.wcs.WCS.html#astropy.wcs.WCS" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.wcs.WCS</span></code></a> object, providing the information on how the data
maps to physical coordinate systems. In some cases e.g. when creating
many maps with the same WCS geometry it can be advantageous to first
create the map geometry independent of the map object it-self:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">wcs_geom</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And then create the map objects from the <code class="docutils literal notranslate"><span class="pre">wcs_geom</span></code> geometry
specification:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="s2">&quot;background&quot;</span><span class="p">]:</span>
    <span class="n">maps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_geom</span><span class="p">(</span><span class="n">wcs_geom</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../api/gammapy.maps.Geom.html#gammapy.maps.Geom" title="gammapy.maps.Geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Geom</span></code></a> object also has a few helpful methods. E.g. we can check
whether a given position on the sky is contained in the map geometry:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the position of the Galactic center and anti-center</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">wcs_geom</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>array([ True, False])
</pre></div>
</div>
<p>Or get the image center of the map:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">wcs_geom</span><span class="o">.</span><span class="n">center_skydir</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (Galactic): (l, b) in deg
    (0., 0.)&gt;
</pre></div>
</div>
<p>Or we can also retrieve the solid angle per pixel of the map:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">wcs_geom</span><span class="o">.</span><span class="n">solid_angle</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[1.21731921e-07 1.21731921e-07 1.21731921e-07 ... 1.21731921e-07
  1.21731921e-07 1.21731921e-07]
 [1.21733761e-07 1.21733761e-07 1.21733761e-07 ... 1.21733761e-07
  1.21733761e-07 1.21733761e-07]
 [1.21735587e-07 1.21735587e-07 1.21735587e-07 ... 1.21735587e-07
  1.21735587e-07 1.21735587e-07]
 ...
 [1.21735587e-07 1.21735587e-07 1.21735587e-07 ... 1.21735587e-07
  1.21735587e-07 1.21735587e-07]
 [1.21733761e-07 1.21733761e-07 1.21733761e-07 ... 1.21733761e-07
  1.21733761e-07 1.21733761e-07]
 [1.21731921e-07 1.21731921e-07 1.21731921e-07 ... 1.21731921e-07
  1.21731921e-07 1.21731921e-07]] sr
</pre></div>
</div>
</section>
<section id="adding-non-spatial-axes">
<h3>Adding Non-Spatial Axes<a class="headerlink" href="#adding-non-spatial-axes" title="Link to this heading">#</a></h3>
<p>In many analysis scenarios we would like to add extra dimension to the
maps to study e.g. energy or time dependency of the data. Those
non-spatial dimensions are handled with the <a class="reference internal" href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapAxis</span></code></a> object. Let us
first define an energy axis, with 4 bins:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;TeV&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">energy_axis</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>MapAxis

        name       : energy
        unit       : &#39;TeV&#39;
        nbins      : 4
        node type  : edges
        edges min  : 1.0e+00 TeV
        edges max  : 1.0e+02 TeV
        interp     : log
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">interp='log'</span></code> specifies that a logarithmic spacing is used
between the bins, equivalent to <code class="docutils literal notranslate"><span class="pre">np.logspace(0,</span> <span class="pre">2,</span> <span class="pre">4)</span></code>. This
<a class="reference internal" href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapAxis</span></code></a> object we can now pass to <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.create" title="gammapy.maps.Map.create"><code class="xref py py-obj docutils literal notranslate"><span class="pre">create()</span></code></a> using the
<code class="docutils literal notranslate"><span class="pre">axes=</span></code> argument:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_cube</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>WcsGeom

        axes       : [&#39;lon&#39;, &#39;lat&#39;, &#39;energy&#39;]
        shape      : (500, 250, 4)
        ndim       : 3
        frame      : galactic
        projection : CAR
        center     : 0.0 deg, 0.0 deg
        width      : 10.0 deg x 5.0 deg
        wcs ref    : 0.0 deg, 0.0 deg
</pre></div>
</div>
<p>Now we see that besides <code class="docutils literal notranslate"><span class="pre">lon</span></code> and <code class="docutils literal notranslate"><span class="pre">lat</span></code> the map has an additional
axes named <code class="docutils literal notranslate"><span class="pre">energy</span></code> with 4 bins. The total dimension of the map is now
<code class="docutils literal notranslate"><span class="pre">ndim=3</span></code>.</p>
<p>We can also add further axes by passing a list of <a class="reference internal" href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapAxis</span></code></a> objects.
To demonstrate this we create a time axis with linearly spaced bins and
pass both axes to <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map.create()</span></code>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">time_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;lin&quot;</span><span class="p">)</span>

<span class="n">m_4d</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">,</span> <span class="n">time_axis</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_4d</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>WcsGeom

        axes       : [&#39;lon&#39;, &#39;lat&#39;, &#39;energy&#39;, &#39;time&#39;]
        shape      : (500, 250, 4, 24)
        ndim       : 4
        frame      : galactic
        projection : CAR
        center     : 0.0 deg, 0.0 deg
        width      : 10.0 deg x 5.0 deg
        wcs ref    : 0.0 deg, 0.0 deg
</pre></div>
</div>
<p>The <a class="reference internal" href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapAxis</span></code></a> object internally stores the coordinates or “position
values” associated with every map axis bin or “node”. We distinguish
between two node types: <code class="docutils literal notranslate"><span class="pre">&quot;edges&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;center&quot;</span></code>. The node type
<code class="docutils literal notranslate"><span class="pre">&quot;edges&quot;</span></code>(which is also the default) specifies that the data
associated with this axis is integrated between the edges of the bin
(e.g. counts data). The node type <code class="docutils literal notranslate"><span class="pre">&quot;center&quot;</span></code> specifies that the data is
given at the center of the bin (e.g. exposure or differential fluxes).</p>
<p>The edges of the bins can be checked with <a class="reference internal" href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis.edges" title="gammapy.maps.MapAxis.edges"><code class="xref py py-obj docutils literal notranslate"><span class="pre">edges</span></code></a> attribute:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">energy_axis</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[  1.           3.16227766  10.          31.6227766  100.        ] TeV
</pre></div>
</div>
<p>The numbers are given in the units we specified above, which can be
checked again with:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">energy_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>TeV
</pre></div>
</div>
<p>The centers of the axis bins can be checked with the <a class="reference internal" href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis.center" title="gammapy.maps.MapAxis.center"><code class="xref py py-obj docutils literal notranslate"><span class="pre">center</span></code></a>
attribute:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">energy_axis</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[ 1.77827941  5.62341325 17.7827941  56.23413252] TeV
</pre></div>
</div>
</section>
<section id="adding-non-contiguous-axes">
<h3>Adding Non-contiguous axes<a class="headerlink" href="#adding-non-contiguous-axes" title="Link to this heading">#</a></h3>
<p>Non-spatial map axes can also be handled through two other objects known as the <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis" title="gammapy.maps.TimeMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeMapAxis</span></code></a>
and the <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis" title="gammapy.maps.LabelMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LabelMapAxis</span></code></a>.</p>
<section id="timemapaxis">
<h4>TimeMapAxis<a class="headerlink" href="#timemapaxis" title="Link to this heading">#</a></h4>
<p>The <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis" title="gammapy.maps.TimeMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeMapAxis</span></code></a> object provides an axis for non-adjacent
time intervals.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">time_map_axis</span> <span class="o">=</span> <span class="n">TimeMapAxis</span><span class="p">(</span>
    <span class="n">edges_min</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
    <span class="n">edges_max</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
    <span class="n">reference_time</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2020-03-19&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>TimeMapAxis
-----------

  name           : time
  nbins          : 4
  reference time : 2020-03-19 00:00:00.000
  scale          : utc
  time min.      : 2020-03-20 00:00:00.000
  time max.      : 2020-04-06 00:00:00.000
  total time     : 216.0 h
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">time_map_axis</span></code> can then be utilised in a similar way to the previous implementation to create
a <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">map_4d</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">,</span> <span class="n">time_map_axis</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">map_4d</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>WcsGeom

        axes       : [&#39;lon&#39;, &#39;lat&#39;, &#39;energy&#39;, &#39;time&#39;]
        shape      : (500, 250, 4, 4)
        ndim       : 4
        frame      : galactic
        projection : CAR
        center     : 0.0 deg, 0.0 deg
        width      : 10.0 deg x 5.0 deg
        wcs ref    : 0.0 deg, 0.0 deg
</pre></div>
</div>
<p>It is possible to utilise the <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.slice" title="gammapy.maps.TimeMapAxis.slice"><code class="xref py py-obj docutils literal notranslate"><span class="pre">slice</span></code></a> attrribute
to create new a <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis" title="gammapy.maps.TimeMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeMapAxis</span></code></a>. Here we are slicing
between the first and third axis to extract the subsection of the axis
between indice 0 and 2.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">slice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>TimeMapAxis
-----------

  name           : time
  nbins          : 2
  reference time : 2020-03-19 00:00:00.000
  scale          : utc
  time min.      : 2020-03-20 00:00:00.000
  time max.      : 2020-04-01 00:00:00.000
  total time     : 96.0 h
</pre></div>
</div>
<p>It is also possible to <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.squash" title="gammapy.maps.TimeMapAxis.squash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">squash</span></code></a> the axis,
which squashes the existing axis into one bin. This creates a new axis
between the extreme edges of the initial axis.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">squash</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>TimeMapAxis
-----------

  name           : time
  nbins          : 1
  reference time : 2020-03-19 00:00:00.000
  scale          : utc
  time min.      : 2020-03-20 00:00:00.000
  time max.      : 2020-04-06 00:00:00.000
  total time     : 408.0 h
</pre></div>
</div>
<p>The <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.is_contiguous" title="gammapy.maps.TimeMapAxis.is_contiguous"><code class="xref py py-obj docutils literal notranslate"><span class="pre">is_contiguous</span></code></a> method returns a boolean
which indicates whether the <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis" title="gammapy.maps.TimeMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeMapAxis</span></code></a> is contiguous or not.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">is_contiguous</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
<p>As we have a non-contiguous axis we can print the array of bin edges for both
the minimum axis edges (<a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.edges_min" title="gammapy.maps.TimeMapAxis.edges_min"><code class="xref py py-obj docutils literal notranslate"><span class="pre">edges_min</span></code></a>) and the maximum axis
edges (<a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.edges_max" title="gammapy.maps.TimeMapAxis.edges_max"><code class="xref py py-obj docutils literal notranslate"><span class="pre">edges_max</span></code></a>).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">edges_min</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">edges_max</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[ 1.  5. 10. 15.] d
[ 2.  7. 13. 18.] d
</pre></div>
</div>
<p>Next, we use the <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.to_contiguous" title="gammapy.maps.TimeMapAxis.to_contiguous"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_contiguous</span></code></a> functionality to
create a contiguous axis and expose <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.edges" title="gammapy.maps.TimeMapAxis.edges"><code class="xref py py-obj docutils literal notranslate"><span class="pre">edges</span></code></a>. This
method returns a <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.units.Quantity.html#astropy.units.Quantity" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> with respect to the reference time.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">time_map_axis_contiguous</span> <span class="o">=</span> <span class="n">time_map_axis</span><span class="o">.</span><span class="n">to_contiguous</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis_contiguous</span><span class="o">.</span><span class="n">is_contiguous</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis_contiguous</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>True
[ 1.  2.  5.  7. 10. 13. 15. 18.] d
</pre></div>
</div>
<p>The <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.time_edges" title="gammapy.maps.TimeMapAxis.time_edges"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time_edges</span></code></a> will return the <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.time.Time.html#astropy.time.Time" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Time</span></code></a> object directly</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis_contiguous</span><span class="o">.</span><span class="n">time_edges</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;2020-03-20 00:00:00.000&#39; &#39;2020-03-21 00:00:00.000&#39;
 &#39;2020-03-24 00:00:00.000&#39; &#39;2020-03-26 00:00:00.000&#39;
 &#39;2020-03-29 00:00:00.000&#39; &#39;2020-04-01 00:00:00.000&#39;
 &#39;2020-04-03 00:00:00.000&#39; &#39;2020-04-06 00:00:00.000&#39;]
</pre></div>
</div>
<p><a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis" title="gammapy.maps.TimeMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeMapAxis</span></code></a> also has both functionalities of
<a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.coord_to_pix" title="gammapy.maps.TimeMapAxis.coord_to_pix"><code class="xref py py-obj docutils literal notranslate"><span class="pre">coord_to_pix</span></code></a> and <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.coord_to_idx" title="gammapy.maps.TimeMapAxis.coord_to_idx"><code class="xref py py-obj docutils literal notranslate"><span class="pre">coord_to_idx</span></code></a>.
The <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.coord_to_idx" title="gammapy.maps.TimeMapAxis.coord_to_idx"><code class="xref py py-obj docutils literal notranslate"><span class="pre">coord_to_idx</span></code></a> attribute will give the index of the
<code class="docutils literal notranslate"><span class="pre">time</span></code> specified, similarly for <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.coord_to_pix" title="gammapy.maps.TimeMapAxis.coord_to_pix"><code class="xref py py-obj docutils literal notranslate"><span class="pre">coord_to_pix</span></code></a> which returns
the pixel. A linear interpolation is assumed.</p>
<p>Start by choosing a time which we know is within the <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis" title="gammapy.maps.TimeMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeMapAxis</span></code></a> and see the results.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">time_max</span><span class="o">.</span><span class="n">mjd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">coord_to_pix</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">coord_to_idx</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[0.5]
0
</pre></div>
</div>
<p>This functionality can also be used with an array of <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.time.Time.html#astropy.time.Time" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Time</span></code></a> values.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">times</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">time_max</span><span class="o">.</span><span class="n">mjd</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">coord_to_pix</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">coord_to_idx</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[0.5 1.5 2.5 3.5]
[0 1 2 3]
</pre></div>
</div>
<p>Note here we take a <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.time.Time.html#astropy.time.Time" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Time</span></code></a> which is outside the edges.
A linear interpolation is assumed for both methods, therefore for a time
outside the <code class="docutils literal notranslate"><span class="pre">time_map_axis</span></code> there is no extrapolation and -1 is returned.</p>
<p>Note: due to this, the <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.coord_to_pix" title="gammapy.maps.TimeMapAxis.coord_to_pix"><code class="xref py py-obj docutils literal notranslate"><span class="pre">coord_to_pix</span></code></a> method will
return <code class="docutils literal notranslate"><span class="pre">nan</span></code> and the <a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis.coord_to_idx" title="gammapy.maps.TimeMapAxis.coord_to_idx"><code class="xref py py-obj docutils literal notranslate"><span class="pre">coord_to_idx</span></code></a> method returns -1.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">coord_to_pix</span><span class="p">(</span><span class="n">Time</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mjd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">time_map_axis</span><span class="o">.</span><span class="n">coord_to_idx</span><span class="p">(</span><span class="n">Time</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mjd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[nan]
-1
</pre></div>
</div>
</section>
<section id="labelmapaxis">
<h4>LabelMapAxis<a class="headerlink" href="#labelmapaxis" title="Link to this heading">#</a></h4>
<p>The <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis" title="gammapy.maps.LabelMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LabelMapAxis</span></code></a> object allows for handling of labels for map axes.
It provides an axis for non-numeric entries.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">label_axis</span> <span class="o">=</span> <span class="n">LabelMapAxis</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dataset-1&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset-2&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset-3&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">label_axis</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>LabelMapAxis
------------

  name       : dataset
  nbins      : 3
  node type  : label
  labels     : [&#39;dataset-1&#39;, &#39;dataset-2&#39;, &#39;dataset-3&#39;]
</pre></div>
</div>
<p>The labels can be checked using the <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis.center" title="gammapy.maps.LabelMapAxis.center"><code class="xref py py-obj docutils literal notranslate"><span class="pre">center</span></code></a> attribute:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">label_axis</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;dataset-1&#39; &#39;dataset-2&#39; &#39;dataset-3&#39;]
</pre></div>
</div>
<p>To obtain the position of the label, one can utilise the <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis.coord_to_pix" title="gammapy.maps.LabelMapAxis.coord_to_pix"><code class="xref py py-obj docutils literal notranslate"><span class="pre">coord_to_pix</span></code></a> attribute</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">label_axis</span><span class="o">.</span><span class="n">coord_to_pix</span><span class="p">([</span><span class="s2">&quot;dataset-3&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[2.]
</pre></div>
</div>
<p>To adapt and create new axes the following attributes can be utilised:
<a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis.concatenate" title="gammapy.maps.LabelMapAxis.concatenate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">concatenate</span></code></a>, <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis.slice" title="gammapy.maps.LabelMapAxis.slice"><code class="xref py py-obj docutils literal notranslate"><span class="pre">slice</span></code></a> and
<a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis.squash" title="gammapy.maps.LabelMapAxis.squash"><code class="xref py py-obj docutils literal notranslate"><span class="pre">squash</span></code></a>.</p>
<p>Combining two different <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis" title="gammapy.maps.LabelMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LabelMapAxis</span></code></a> is done in the following way:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">label_axis2</span> <span class="o">=</span> <span class="n">LabelMapAxis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dataset-a&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset-b&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">label_axis</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">label_axis2</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>LabelMapAxis
------------

  name       : dataset
  nbins      : 5
  node type  : label
  labels     : [&#39;dataset-1&#39;, &#39;dataset-2&#39;, &#39;dataset-3&#39;, &#39;dataset-a&#39;, &#39;dataset-b&#39;]
</pre></div>
</div>
<p>A new <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis" title="gammapy.maps.LabelMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LabelMapAxis</span></code></a> can be created by slicing an already existing one.
Here we are slicing between the second and third bins to extract the subsection.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">label_axis</span><span class="o">.</span><span class="n">slice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>LabelMapAxis
------------

  name       : dataset
  nbins      : 2
  node type  : label
  labels     : [&#39;dataset-2&#39;, &#39;dataset-3&#39;]
</pre></div>
</div>
<p>A new axis object can be created by squashing the axis into a single bin.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">label_axis</span><span class="o">.</span><span class="n">squash</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>LabelMapAxis
------------

  name       : dataset
  nbins      : 1
  node type  : label
  labels     : [&#39;dataset-1...dataset-3&#39;]
</pre></div>
</div>
<p>Mixing the three previous axis types (<a class="reference internal" href="../../api/gammapy.maps.MapAxis.html#gammapy.maps.MapAxis" title="gammapy.maps.MapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapAxis</span></code></a>,
<a class="reference internal" href="../../api/gammapy.maps.TimeMapAxis.html#gammapy.maps.TimeMapAxis" title="gammapy.maps.TimeMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TimeMapAxis</span></code></a> and <a class="reference internal" href="../../api/gammapy.maps.LabelMapAxis.html#gammapy.maps.LabelMapAxis" title="gammapy.maps.LabelMapAxis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LabelMapAxis</span></code></a>)
would be done like so:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">axes</span> <span class="o">=</span> <span class="n">MapAxes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">,</span> <span class="n">time_map_axis</span><span class="p">,</span> <span class="n">label_axis</span><span class="p">])</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">to_table_hdu</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;gadf&quot;</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>CHANNEL       ENERGY             E_MIN              E_MAX        TIME TIME_MIN TIME_MAX  DATASET
               TeV                TeV                TeV          d      d        d
------- ------------------ ------------------ ------------------ ---- -------- -------- ---------
      0 1.7782794100389228                1.0  3.162277660168379  1.5      1.0      2.0 dataset-1
      1 1.7782794100389228                1.0  3.162277660168379  1.5      1.0      2.0 dataset-2
      2 1.7782794100389228                1.0  3.162277660168379  1.5      1.0      2.0 dataset-3
      3   5.62341325190349  3.162277660168379  9.999999999999998  1.5      1.0      2.0 dataset-1
    ...                ...                ...                ...  ...      ...      ...       ...
     43  17.78279410038922  9.999999999999998 31.622776601683793 16.5     15.0     18.0 dataset-2
     44  17.78279410038922  9.999999999999998 31.622776601683793 16.5     15.0     18.0 dataset-3
     45 56.234132519034866 31.622776601683793  99.99999999999994 16.5     15.0     18.0 dataset-1
     46 56.234132519034866 31.622776601683793  99.99999999999994 16.5     15.0     18.0 dataset-2
     47 56.234132519034866 31.622776601683793  99.99999999999994 16.5     15.0     18.0 dataset-3
Length = 48 rows
</pre></div>
</div>
</section>
</section>
</section>
<section id="reading-and-writing">
<h2>Reading and Writing<a class="headerlink" href="#reading-and-writing" title="Link to this heading">#</a></h2>
<p>Gammapy <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> objects are serialized using the Flexible Image
Transport Format (FITS). Depending on the pixelization scheme (HEALPix
or WCS) and presence of non-spatial dimensions the actual convention to
write the FITS file is different. By default Gammapy uses a generic
convention named <code class="docutils literal notranslate"><span class="pre">&quot;gadf&quot;</span></code>, which will support WCS and HEALPix formats as
well as an arbitrary number of non-spatial axes. The convention is
documented in detail on the <a class="reference external" href="https://gamma-astro-data-formats.readthedocs.io/en/latest/skymaps/index.html">Gamma Astro Data
Formats</a>
page.</p>
<p>Other conventions required by specific software (e.g. the Fermi Science
Tools) are supported as well. At the moment those are the following</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fgst-ccube&quot;</span></code>: Fermi counts cube format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fgst-ltcube&quot;</span></code>: Fermi livetime cube format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fgst-bexpcube&quot;</span></code>: Fermi exposure cube format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fgst-template&quot;</span></code>: Fermi Galactic diffuse and source template format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;fgst-srcmap&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;fgst-srcmap-sparse&quot;</span></code>: Fermi source map and
sparse source map format.</p></li>
</ul>
<p>The conventions listed above only support an additional energy axis.</p>
<section id="reading-maps">
<h3>Reading Maps<a class="headerlink" href="#reading-maps" title="Link to this heading">#</a></h3>
<p>Reading FITS files is mainly exposed via the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.read" title="gammapy.maps.Map.read"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read()</span></code></a> method. Let
us take a look at a first example:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-counts.fits.gz&quot;</span>
<span class="n">m_3fhl_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_3fhl_gc</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-pytb notranslate"><div class="highlight"><pre><span></span><span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/examples/tutorials/api/maps.py&quot;</span>, line <span class="m">493</span>, in <span class="n">&lt;module&gt;</span>
<span class="w">    </span><span class="n">m_3fhl_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/gammapy/maps/core.py&quot;</span>, line <span class="m">254</span>, in <span class="n">read</span>
<span class="w">    </span><span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/hdu/hdulist.py&quot;</span>, line <span class="m">214</span>, in <span class="n">fitsopen</span>
<span class="w">    </span><span class="k">return</span> <span class="n">HDUList</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/hdu/hdulist.py&quot;</span>, line <span class="m">482</span>, in <span class="n">fromfile</span>
<span class="w">    </span><span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_readfrom</span><span class="p">(</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/hdu/hdulist.py&quot;</span>, line <span class="m">1170</span>, in <span class="n">_readfrom</span>
<span class="w">    </span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">_File</span><span class="p">(</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/file.py&quot;</span>, line <span class="m">218</span>, in <span class="n">__init__</span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">_open_filename</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/file.py&quot;</span>, line <span class="m">636</span>, in <span class="n">_open_filename</span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">IO_FITS_MODES</span><span class="p">[</span><span class="n">mode</span><span class="p">])</span>
<span class="gr">FileNotFoundError</span>: <span class="n">[Errno 2] Aucun fichier ou dossier de ce type: &#39;gammapy-data/fermi-3fhl-gc/fermi-3fhl-gc-counts.fits.gz&#39;</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">map_type</span></code> argument is not given when calling read a map object
will be instantiated with the pixelization of the input HDU.</p>
<p>By default <code class="docutils literal notranslate"><span class="pre">Map.read()</span></code> will try to find the first valid data hdu in
the filename and read the data from there. If multiple HDUs are present
in the FITS file, the desired one can be chosen with the additional
<code class="xref py py-obj docutils literal notranslate"><span class="pre">hdu=</span></code> argument:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_3fhl_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_3fhl_gc</span><span class="p">)</span>
</pre></div>
</div>
<p>In rare cases e.g. when the FITS file is not valid or meta data is
missing from the header it can be necessary to modify the header of a
certain HDU before creating the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code> object. In this case we can use
<a class="reference external" href="https://docs.astropy.org/en/latest/io/fits/index.html#module-astropy.io.fits" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.io.fits</span></code></a> directly to read the FITS file:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GAMMAPY_DATA&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/fermi-3fhl-gc/fermi-3fhl-gc-exposure.fits.gz&quot;</span>
<span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hdulist</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
<p>And then modify the header keyword and use <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map.from_hdulist()</span></code> to
create the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code> object after:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">hdulist</span><span class="p">[</span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;BUNIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm2 s&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Map</span><span class="o">.</span><span class="n">from_hdulist</span><span class="p">(</span><span class="n">hdulist</span><span class="o">=</span><span class="n">hdulist</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="writing-maps">
<h3>Writing Maps<a class="headerlink" href="#writing-maps" title="Link to this heading">#</a></h3>
<p>Writing FITS files on disk via the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map.write()</span></code> method.
Here is a first example:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;example_cube.fits&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>By default Gammapy does not overwrite files. In this example we set
<code class="xref py py-obj docutils literal notranslate"><span class="pre">overwrite=True</span></code> in case the cell gets executed multiple times. Now we
can read back the cube from disk using <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map.read()</span></code>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;example_cube.fits&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_cube</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also choose a different FITS convention to write the example cube
in a format compatible to the Fermi Galactic diffuse background model:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;example_cube_fgst.fits&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;fgst-template&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To understand a little bit better the generic <code class="xref py py-obj docutils literal notranslate"><span class="pre">gadf</span></code> convention we use
<code class="xref py py-obj docutils literal notranslate"><span class="pre">Map.to_hdulist()</span></code> to generate a list of FITS HDUs first:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">hdulist</span> <span class="o">=</span> <span class="n">m_4d</span><span class="o">.</span><span class="n">to_hdulist</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;gadf&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hdulist</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
<p>As we can see the <code class="xref py py-obj docutils literal notranslate"><span class="pre">HDUList</span></code> object contains to HDUs. The first one
named <code class="xref py py-obj docutils literal notranslate"><span class="pre">PRIMARY</span></code> contains the data array with shape corresponding to
our data and the WCS information stored in the header:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
</pre></div>
</div>
<p>The second HDU is a <code class="xref py py-obj docutils literal notranslate"><span class="pre">BinTableHDU</span></code> named <code class="xref py py-obj docutils literal notranslate"><span class="pre">PRIMARY_BANDS</span></code> contains the
information on the non-spatial axes such as name, order, unit, min, max
and center values of the axis bins. We use an <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.table.Table.html#astropy.table.Table" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy.table.Table</span></code></a> to
show the information:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="s2">&quot;PRIMARY_BANDS&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Maps can be serialized to a sparse data format by calling write with
<code class="xref py py-obj docutils literal notranslate"><span class="pre">sparse=True</span></code>. This will write all non-zero pixels in the map to a
data table appropriate to the pixelization scheme.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;wcs&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;file.fits&quot;</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s2">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;file.fits&quot;</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s2">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;wcs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="accessing-data">
<h2>Accessing Data<a class="headerlink" href="#accessing-data" title="Link to this heading">#</a></h2>
<section id="how-to-get-data-values">
<h3>How to get data values<a class="headerlink" href="#how-to-get-data-values" title="Link to this heading">#</a></h3>
<p>All map objects have a set of accessor methods, which can be used to
access or update the contents of the map irrespective of its underlying
representation. Those accessor methods accept as their first argument a
coordinate <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple</span></code></a> containing scalars, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a>, or <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>
with one tuple element for each dimension. Some methods additionally
accept a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">MapCoord</span></code> argument, of which both allow to
assign coordinates by axis name.</p>
<p>Let us first begin with the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.get_by_idx" title="gammapy.maps.Map.get_by_idx"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_by_idx()</span></code></a> method, that accepts a
tuple of indices. The order of the indices corresponds to the axis order
of the map:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_idx</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<p><strong>Important:</strong> Gammapy uses a reversed index order in the map API with
the longitude axes first. To achieve the same by directly indexing into
the numpy array we have to call:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">data</span><span class="p">[([</span><span class="mi">30</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">])])</span>
</pre></div>
</div>
<p>To check the order of the axes you can always print the <code class="docutils literal notranslate"><span class="pre">.geom`</span></code>
attribute:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
<p>To access values directly by sky coordinates we can use the
<a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.get_by_coord" title="gammapy.maps.Map.get_by_coord"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_by_coord()</span></code></a> method. This time we pass in a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>, specifying
the axes names corresponding to the given coordinates:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}))</span>
</pre></div>
</div>
<p>The units of the coordinates are assumed to be in degrees in the
coordinate system used by the map. If the coordinates do not correspond
to the exact pixel center, the value of the nearest pixel center will be
returned. For positions outside the map geometry <code class="xref py py-obj docutils literal notranslate"><span class="pre">np.nan</span></code> is returned.</p>
<p>The coordinate or idx arrays follow normal <a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/02.05-computation-on-arrays-broadcasting.html">Numpy broadcasting
rules</a>.
So the following works as expected:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="n">lons</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}))</span>
</pre></div>
</div>
<p>Or as an even more advanced example, we can provide <code class="xref py py-obj docutils literal notranslate"><span class="pre">lats</span></code> as column
vector and broadcasting to a 2D result array will be applied:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="n">lons</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">lats</span><span class="p">}))</span>
</pre></div>
</div>
</section>
<section id="indexing-and-slicing-sub-maps">
<h3>Indexing and Slicing Sub-Maps<a class="headerlink" href="#indexing-and-slicing-sub-maps" title="Link to this heading">#</a></h3>
<p>When you have worked with Numpy arrays in the past you are probably
familiar with the concept of indexing and slicing into data arrays. To
support slicing of non-spatial axes of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code> objects, the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code>
object has a <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.slice_by_idx" title="gammapy.maps.Map.slice_by_idx"><code class="xref py py-obj docutils literal notranslate"><span class="pre">slice_by_idx()</span></code></a> method, which allows to extract
sub-maps from a larger map.</p>
<p>The following example demonstrates how to get the map at the energy bin
number 3:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_sub</span> <span class="o">=</span> <span class="n">m_cube</span><span class="o">.</span><span class="n">slice_by_idx</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_sub</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the returned object is again a <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> with updated axes
information. In this case, because we extracted only a single image, the
energy axes is dropped from the map.</p>
<p>To extract a sub-cube with a sliced energy axes we can use a normal
<code class="docutils literal notranslate"><span class="pre">slice()</span></code> object:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_sub</span> <span class="o">=</span> <span class="n">m_cube</span><span class="o">.</span><span class="n">slice_by_idx</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_sub</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the returned object is also a <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> object, but this time
with updated energy axis specification.</p>
<p>Slicing of multiple dimensions is supported by adding further entries to
the dict passed to <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.slice_by_idx" title="gammapy.maps.Map.slice_by_idx"><code class="xref py py-obj docutils literal notranslate"><span class="pre">slice_by_idx()</span></code></a></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_sub</span> <span class="o">=</span> <span class="n">m_4d</span><span class="o">.</span><span class="n">slice_by_idx</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_sub</span><span class="p">)</span>
</pre></div>
</div>
<p>For convenience there is also a <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.get_image_by_coord" title="gammapy.maps.Map.get_image_by_coord"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_image_by_coord()</span></code></a> method which
allows to access image planes at given non-spatial physical coordinates.
This method also supports <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.units.Quantity.html#astropy.units.Quantity" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Quantity</span></code></a> objects:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">m_4d</span><span class="o">.</span><span class="n">get_image_by_coord</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">h</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="iterating-by-image">
<h3>Iterating by image<a class="headerlink" href="#iterating-by-image" title="Link to this heading">#</a></h3>
<p>For maps with non-spatial dimensions the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.iter_by_image_data" title="gammapy.maps.Map.iter_by_image_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">iter_by_image_data</span></code></a>
method can be used to loop over image slices. The image plane index
<code class="xref py py-obj docutils literal notranslate"><span class="pre">idx</span></code> is returned in data order, so that the data array can be indexed
directly. Here is an example for an in-place convolution of an image
using <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.convolution.convolve.html#astropy.convolution.convolve" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolve</span></code></a> to interpolate NaN values:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">axis1</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">)</span>
<span class="n">axis2</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;lin&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">],</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="k">for</span> <span class="n">img</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">iter_by_image_data</span><span class="p">():</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>

<span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="modifying-data">
<h2>Modifying Data<a class="headerlink" href="#modifying-data" title="Link to this heading">#</a></h2>
<section id="how-to-set-data-values">
<h3>How to set data values<a class="headerlink" href="#how-to-set-data-values" title="Link to this heading">#</a></h3>
<p>To modify and set map data values the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code> object features as well a
<a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.set_by_idx" title="gammapy.maps.Map.set_by_idx"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_by_idx()</span></code></a> method:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">set_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">vals</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>here we check that data have been updated:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_cube</span><span class="o">.</span><span class="n">get_by_idx</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
<p>Of course there is also a <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.set_by_coord" title="gammapy.maps.Map.set_by_coord"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_by_coord()</span></code></a> method, which allows to
set map data values in physical coordinates.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">set_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">},</span> <span class="n">vals</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>Again the <code class="xref py py-obj docutils literal notranslate"><span class="pre">lon</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">lat</span></code> values are assumed to be given in degrees
in the coordinate system used by the map. For the energy axis, the unit
is the one specified on the axis (use <code class="docutils literal notranslate"><span class="pre">m_cube.geom.axes[0].unit</span></code> to
check if needed…).</p>
<p>All <code class="docutils literal notranslate"><span class="pre">.xxx_by_coord()</span></code> methods accept <a class="reference external" href="https://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord" title="(in Astropy v6.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyCoord</span></code></a> objects as well. In
this case we have to use the <code class="docutils literal notranslate"><span class="pre">&quot;skycoord&quot;</span></code> keyword instead of <code class="docutils literal notranslate"><span class="pre">&quot;lon&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&quot;lat&quot;</span></code>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">skycoords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">m_cube</span><span class="o">.</span><span class="n">set_by_coord</span><span class="p">({</span><span class="s2">&quot;skycoord&quot;</span><span class="p">:</span> <span class="n">skycoords</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">},</span> <span class="n">vals</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="filling-maps-from-event-lists">
<h3>Filling maps from event lists<a class="headerlink" href="#filling-maps-from-event-lists" title="Link to this heading">#</a></h3>
<p>This example shows how to fill a counts cube from an event list:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
    <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GeV&quot;</span>
<span class="p">)</span>
<span class="n">counts_3d</span> <span class="o">=</span> <span class="n">WcsNDMap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">events</span> <span class="o">=</span> <span class="n">EventList</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-events.fits.gz&quot;</span><span class="p">)</span>

<span class="n">counts_3d</span><span class="o">.</span><span class="n">fill_by_coord</span><span class="p">({</span><span class="s2">&quot;skycoord&quot;</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">radec</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">energy</span><span class="p">})</span>
<span class="n">counts_3d</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ccube.fits&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;fgst-ccube&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively you can use the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.fill_events" title="gammapy.maps.Map.fill_events"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fill_events</span></code></a> method:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">counts_3d</span> <span class="o">=</span> <span class="n">WcsNDMap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">counts_3d</span><span class="o">.</span><span class="n">fill_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have a given map already, and want to make a counts image with
the same geometry (not using the pixel data from the original map), you
can also use the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.fill_events" title="gammapy.maps.Map.fill_events"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fill_events</span></code></a> method.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">events</span> <span class="o">=</span> <span class="n">EventList</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-events.fits.gz&quot;</span><span class="p">)</span>
<span class="n">reference_map</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-counts.fits.gz&quot;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_geom</span><span class="p">(</span><span class="n">reference_map</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
<span class="n">counts</span><span class="o">.</span><span class="n">fill_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
<p>It works for IACT and Fermi-LAT events, for WCS or HEALPix map
geometries, and also for extra axes. Especially energy axes are
automatically handled correctly.</p>
</section>
<section id="filling-maps-from-interpolation">
<h3>Filling maps from interpolation<a class="headerlink" href="#filling-maps-from-interpolation" title="Link to this heading">#</a></h3>
<p>Maps support interpolation via the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.interp_by_coord" title="gammapy.maps.Map.interp_by_coord"><code class="xref py py-obj docutils literal notranslate"><span class="pre">interp_by_coord</span></code></a> and
<a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.interp_by_pix" title="gammapy.maps.Map.interp_by_pix"><code class="xref py py-obj docutils literal notranslate"><span class="pre">interp_by_pix</span></code></a> methods. Currently, the following interpolation
methods are supported:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;nearest&quot;</span></code> : Return value of nearest pixel (no interpolation).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;linear&quot;</span></code> : Interpolation with first order polynomial. This is the
only interpolation method that is supported for all map types.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">quadratic</span></code> : Interpolation with second order polynomial.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">cubic</span></code> : Interpolation with third order polynomial.</p></li>
</ul>
<p>Note that <code class="docutils literal notranslate"><span class="pre">&quot;quadratic&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;cubic&quot;</span></code> interpolation are currently only
supported for WCS-based maps with regular geometry (e.g. 2D or ND with
the same geometry in every image plane). <code class="docutils literal notranslate"><span class="pre">&quot;linear&quot;</span></code> and higher order
interpolation by pixel coordinates is only supported for WCS-based maps.</p>
<p>In the following example we create a new map and fill it by
interpolating another map:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># read map</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/gll_iem_v06_gc.fits.gz&quot;</span>
<span class="n">m_iem_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># create new geometry</span>
<span class="n">skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">266.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.9</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">wcs_geom_cel</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">skydir</span><span class="o">=</span><span class="n">skydir</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># create new empty map from geometry</span>
<span class="n">m_iem_10GeV</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_geom</span><span class="p">(</span><span class="n">wcs_geom_cel</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">()</span>

<span class="c1"># fill new map using interpolation</span>
<span class="n">m_iem_10GeV</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">m_iem_gc</span><span class="o">.</span><span class="n">interp_by_coord</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;skycoord&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="o">.</span><span class="n">skycoord</span><span class="p">,</span> <span class="s2">&quot;energy_true&quot;</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">GeV</span><span class="p">},</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="interpolating-onto-a-different-geometry">
<h3>Interpolating onto a different geometry<a class="headerlink" href="#interpolating-onto-a-different-geometry" title="Link to this heading">#</a></h3>
<p>For 3d geometries this operation can be performed directly using the
<a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.interp_to_geom" title="gammapy.maps.Map.interp_to_geom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">interp_to_geom()</span></code></a> method. This is very useful, ex: while using map
arithmetic.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create new geometry</span>
<span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
    <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_true&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GeV&quot;</span>
<span class="p">)</span>
<span class="n">skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">266.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.9</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">wcs_geom_3d</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">skydir</span><span class="o">=</span><span class="n">skydir</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># create the interpolated map</span>
<span class="n">m_iem_interp</span> <span class="o">=</span> <span class="n">m_iem_gc</span><span class="o">.</span><span class="n">interp_to_geom</span><span class="p">(</span>
    <span class="n">wcs_geom_3d</span><span class="p">,</span> <span class="n">preserve_counts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_iem_interp</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">preserve_counts=</span></code> option should be true if the map is an
integral quantity (e.g. counts) and false if the map is a differential
quantity (e.g. intensity).</p>
</section>
</section>
<section id="maps-operations">
<h2>Maps operations<a class="headerlink" href="#maps-operations" title="Link to this heading">#</a></h2>
<section id="basic-operators">
<h3>Basic operators<a class="headerlink" href="#basic-operators" title="Link to this heading">#</a></h3>
<p>One can perform simple arithmetic on maps using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">+</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">-</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">*</span></code>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">/</span></code> operators, this works only for maps with the same geometry:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">iem_plus_iem</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span> <span class="o">+</span> <span class="n">m_iem_10GeV</span>

<span class="n">iem_minus_iem</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span> <span class="o">-</span> <span class="n">m_iem_10GeV</span>
</pre></div>
</div>
<p>These operations can be applied between a Map and a scalar in that
specific order:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">iem_times_two</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span> <span class="o">*</span> <span class="mi">2</span>
<span class="c1"># iem_times_two = 2 * m_iem_10GeV # this won&#39;t work</span>
</pre></div>
</div>
<p>The logic operators can also be applied on maps (the result is a map of
boolean type):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">is_null</span> <span class="o">=</span> <span class="n">iem_minus_iem</span> <span class="o">==</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">is_null</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we check that the result is <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.12)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a> for all the well-defined
pixels (not <code class="xref py py-obj docutils literal notranslate"><span class="pre">NaN</span></code>):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">is_null</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">iem_minus_iem</span><span class="p">)]))</span>
</pre></div>
</div>
</section>
<section id="cutouts">
<h3>Cutouts<a class="headerlink" href="#cutouts" title="Link to this heading">#</a></h3>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">WCSNDMap</span></code> objects features a <code class="xref py py-obj docutils literal notranslate"><span class="pre">cutout()</span></code> method, which allows
you to cut out a smaller part of a larger map. This can be useful,
e.g. when working with all-sky diffuse maps. Here is an example:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">position</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">m_iem_cutout</span> <span class="o">=</span> <span class="n">m_iem_gc</span><span class="o">.</span><span class="n">cutout</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
</pre></div>
</div>
<p>The returned object is again a <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> object with updated WCS
information and data size. As one can see the cutout is automatically
applied to all the non-spatial axes as well. The cutout width is given
in the order of <code class="xref py py-obj docutils literal notranslate"><span class="pre">(lon,</span> <span class="pre">lat)</span></code> and can be specified with units that will
be handled correctly.</p>
</section>
</section>
<section id="visualizing-and-plotting">
<h2>Visualizing and Plotting<a class="headerlink" href="#visualizing-and-plotting" title="Link to this heading">#</a></h2>
<p>All map objects provide a <code class="xref py py-obj docutils literal notranslate"><span class="pre">plot</span></code> method for generating a visualization
of a map. This method returns figure, axes, and image objects that can
be used to further tweak/customize the image. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">plot</span></code> method should
be used with 2D maps, while 3D maps can be displayed with the
<a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.plot_interactive" title="gammapy.maps.Map.plot_interactive"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_interactive()</span></code></a> or <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.plot_grid" title="gammapy.maps.Map.plot_grid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_grid()</span></code></a> methods.</p>
<section id="image-plotting">
<h3>Image Plotting<a class="headerlink" href="#image-plotting" title="Link to this heading">#</a></h3>
<p>For debugging and inspecting the map data it is useful to plot or
visualize the images planes contained in the map.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-counts.fits.gz&quot;</span>
<span class="n">m_3fhl_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>After reading the map we can now plot it on the screen by calling the
<code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">m_3fhl_gc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>We can easily improve the plot by calling <code class="xref py py-obj docutils literal notranslate"><span class="pre">smooth()</span></code> first and
providing additional arguments to <code class="xref py py-obj docutils literal notranslate"><span class="pre">plot()</span></code>. Most of them are passed
further to
<a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.imshow.html">plt.imshow()</a>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">smoothed</span> <span class="o">=</span> <span class="n">m_3fhl_gc</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>We can use the
<a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.rc_context.html">plt.rc_context()</a>
context manager to further tweak the plot by adapting the figure and
font size:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">rc_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">),</span> <span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">rc_context</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="n">rc_params</span><span class="p">):</span>
    <span class="n">smoothed</span> <span class="o">=</span> <span class="n">m_3fhl_gc</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
    <span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="cube-plotting">
<h3>Cube plotting<a class="headerlink" href="#cube-plotting" title="Link to this heading">#</a></h3>
<p>For maps with non-spatial dimensions the <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> object features an
interactive plotting method, that works in jupyter notebooks only (Note:
it requires the package <code class="xref py py-obj docutils literal notranslate"><span class="pre">ipywidgets</span></code> to be installed). We first read a
small example cutout from the Fermi Galactic diffuse model and display
the data cube by calling <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.plot_interactive" title="gammapy.maps.Map.plot_interactive"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_interactive()</span></code></a>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">rc_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">),</span>
    <span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s2">&quot;axes.formatter.limits&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">m_iem_gc</span><span class="o">.</span><span class="n">plot_interactive</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="n">rc_params</span><span class="o">=</span><span class="n">rc_params</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Now you can use the interactive slider to select an energy range and the
corresponding image is displayed on the screen. You can also use the
radio buttons to select your preferred image stretching. We have passed
additional keywords using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">rc_params</span></code> argument to improve the
figure and font size. Those keywords are directly passed to the
<a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.rc_context.html">plt.rc_context()</a>
context manager.</p>
<p>Additionally all the slices of a 3D <a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map" title="gammapy.maps.Map"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Map</span></code></a> can be displayed using the
<a class="reference internal" href="../../api/gammapy.maps.Map.html#gammapy.maps.Map.plot_grid" title="gammapy.maps.Map.plot_grid"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_grid()</span></code></a> method. By default the colorbars bounds of the subplots
are not the same, we can make them consistent using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">vmin</span></code> and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">vmax</span></code> options:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">counts_3d</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-api-maps-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/master?urlpath=lab/tree/notebooks/dev/tutorials/api/maps.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo4.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/5f320bc7e76a524223d801abe9ef46e6/maps.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">maps.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/b7957f43ba7bcfcfd46ad57faa8b16d9/maps.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">maps.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-setup">Check setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-wcs-maps">Creating WCS Maps</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-factory-methods">Using Factory Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-from-a-map-geometry">Creating from a Map Geometry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-non-spatial-axes">Adding Non-Spatial Axes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-non-contiguous-axes">Adding Non-contiguous axes</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#timemapaxis">TimeMapAxis</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#labelmapaxis">LabelMapAxis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-and-writing">Reading and Writing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-maps">Reading Maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-maps">Writing Maps</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-data">Accessing Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-get-data-values">How to get data values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-slicing-sub-maps">Indexing and Slicing Sub-Maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterating-by-image">Iterating by image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-data">Modifying Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-set-data-values">How to set data values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filling-maps-from-event-lists">Filling maps from event lists</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filling-maps-from-interpolation">Filling maps from interpolation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolating-onto-a-different-geometry">Interpolating onto a different geometry</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maps-operations">Maps operations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-operators">Basic operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cutouts">Cutouts</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-and-plotting">Visualizing and Plotting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#image-plotting">Image Plotting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cube-plotting">Cube plotting</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/tutorials/api/maps.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, The Gammapy developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>