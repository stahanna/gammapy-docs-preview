
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Event sampling &#8212; gammapy vX.Y.Z</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css?v=995e94df" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.min.css?v=21c0b90a" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=bf3cbe73" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=23d6972c"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/analysis-3d/event_sampling';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://docs.gammapy.org/stable/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sample a source with energy-dependent temporal evolution" href="event_sampling_nrg_depend_models.html" />
    <link rel="prev" title="Morphological energy dependence estimation" href="energy_dependent_estimation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="02 Apr 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/gammapy_logo_nav.png" class="logo__image only-light" alt="gammapy vX.Y.Z - Home"/>
    <script>document.write(`<img src="../../_static/gammapy_logo_nav.png" class="logo__image only-dark" alt="gammapy vX.Y.Z - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting-started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user-guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api-reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../development/index.html">
                        Developer guide
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../release-notes/index.html">
                        Release notes
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/gammapyST" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-slack fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting-started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user-guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api-reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../development/index.html">
                        Developer guide
                      </a>
                    </li>
                
            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links-2">
                    More
                </button>
                <ul id="pst-nav-more-links-2" class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link dropdown-item nav-internal" href="../../release-notes/index.html">
                        Release notes
                      </a>
                    </li>
                
                </ul>
            </li>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/gammapy/gammapy" title="Github" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Github</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/gammapyST" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gammapy.slack.com/" title="Slack" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-slack fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">Slack</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../starting/analysis_1.html">High level interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting/analysis_2.html">Low level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starting/overview.html">Data structures</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data/cta.html">CTA with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/fermi_lat.html">Fermi-LAT with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/hawc.html">HAWC with Gammapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/hess.html">H.E.S.S. with Gammapy</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/cta_sensitivity.html">Point source sensitivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/extended_source_spectral_analysis.html">Spectral analysis of extended sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/sed_fitting.html">Flux point fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectral_analysis.html">Spectral analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectral_analysis_hli.html">Spectral analysis with the HLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectral_analysis_rad_max.html">Spectral analysis with energy-dependent directional cuts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-1d/spectrum_simulation.html">1D spectrum simulation</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/detect.html">Source detection and significance maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/modeling_2D.html">2D map fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-2d/ring_background.html">Ring background map</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="analysis_3d.html">3D detailed analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis_mwl.html">Multi instrument joint 3D and 1D analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="cta_data_analysis.html">Basic image exploration and fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="energy_dependent_estimation.html">Morphological energy dependence estimation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Event sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_sampling_nrg_depend_models.html">Sample a source with energy-dependent temporal evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="flux_profiles.html">Flux Profile Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulate_3d.html">3D map simulation</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/Variability_estimation.html">Estimation of time variability in a lightcurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve.html">Light curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve_flare.html">Light curves for flares</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/light_curve_simulation.html">Simulating and fitting a time varying source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis-time/pulsar_analysis.html">Pulsar analysis</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api/astro_dark_matter.html">Dark matter spatial and spectral models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/catalog.html">Source catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/datasets.html">Datasets - Reduced data, IRFs, models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/fitting.html">Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/irfs.html">Using Gammapy IRFs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/makers.html">Makers - Data reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/maps.html">Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/mask_maps.html">Mask maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/model_management.html">Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/observation_clustering.html">Observational clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/priors.html">Priors</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../scripts/survey_map.html">Survey Map Script</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Event sampling</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-tutorials-analysis-3d-event-sampling-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="event-sampling">
<span id="sphx-glr-tutorials-analysis-3d-event-sampling-py"></span><h1>Event sampling<a class="headerlink" href="#event-sampling" title="Link to this heading">#</a></h1>
<p>Learn to sampling events from a given sky model and IRFs.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h2>
<p>To understand how to generate a model and a <a class="reference internal" href="../../api/gammapy.datasets.MapDataset.html#gammapy.datasets.MapDataset" title="gammapy.datasets.MapDataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDataset</span></code></a> and how to fit
the data, please refer to the <a class="reference internal" href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyModel</span></code></a> and
<a class="reference internal" href="simulate_3d.html"><span class="doc">3D map simulation</span></a> tutorial.</p>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Link to this heading">#</a></h2>
<p>This tutorial describes how to sample events from an observation of a
one (or more) gamma-ray source(s). The main aim of the tutorial will be
to set the minimal configuration needed to deal with the Gammapy
event-sampler and how to obtain an output photon event list.</p>
<p>The core of the event sampling lies into the Gammapy
<a class="reference internal" href="../../api/gammapy.datasets.MapDatasetEventSampler.html#gammapy.datasets.MapDatasetEventSampler" title="gammapy.datasets.MapDatasetEventSampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatasetEventSampler</span></code></a> class, which is based on
the inverse cumulative distribution function <a class="reference external" href="https://en.wikipedia.org/wiki/Cumulative_distribution_function#Inverse_distribution_function_(quantile_function)">(Inverse
CDF)</a>.</p>
<p>The <a class="reference internal" href="../../api/gammapy.datasets.MapDatasetEventSampler.html#gammapy.datasets.MapDatasetEventSampler" title="gammapy.datasets.MapDatasetEventSampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatasetEventSampler</span></code></a> takes in input a
<a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> object containing the spectral, spatial
and temporal properties of the source(s) of interest.</p>
<p>The <a class="reference internal" href="../../api/gammapy.datasets.MapDatasetEventSampler.html#gammapy.datasets.MapDatasetEventSampler" title="gammapy.datasets.MapDatasetEventSampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatasetEventSampler</span></code></a> class evaluates the map
of predicted counts (<code class="xref py py-obj docutils literal notranslate"><span class="pre">npred</span></code>) per bin of the given Sky model, and the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">npred</span></code> map is then used to sample the events. In particular, the
output of the event-sampler will be a set of events having information
about their true coordinates, true energies and times of arrival.</p>
<p>To these events, IRF corrections (i.e. PSF and energy dispersion) can
also further be applied in order to obtain reconstructed coordinates and
energies of the sampled events.</p>
<p>At the end of this process, you will obtain an event-list in FITS
format.</p>
</section>
<section id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Link to this heading">#</a></h2>
<p>Describe the process of sampling events from a given Sky model and
obtain an output event-list.</p>
</section>
<section id="proposed-approach">
<h2>Proposed approach<a class="headerlink" href="#proposed-approach" title="Link to this heading">#</a></h2>
<p>In this section, we will show how to define an observation and create
a Dataset object. These are both necessary for the event sampling. Then,
we will define the Sky model from which we sample events.</p>
<p>In this tutorial, we propose examples for sampling events of:</p>
<ul class="simple">
<li><p><a class="reference external" href="#sampling-the-source-and-background-events">a point-like source</a></p></li>
<li><p><a class="reference external" href="#time-variable-source-using-a-lightcurve">a time variable point-like
source</a></p></li>
<li><p><a class="reference external" href="#extended-source-using-a-template">an extended source using a template
map</a></p></li>
<li><p><a class="reference external" href="#simulate-multiple-event-lists">a set of observations</a></p></li>
</ul>
<p>We will work with the following functions and classes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/gammapy.data.Observations.html#gammapy.data.Observations" title="gammapy.data.Observations"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Observations</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyModel</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/gammapy.datasets.MapDatasetEventSampler.html#gammapy.datasets.MapDatasetEventSampler" title="gammapy.datasets.MapDatasetEventSampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatasetEventSampler</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/gammapy.data.EventList.html#gammapy.data.EventList" title="gammapy.data.EventList"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EventList</span></code></a></p></li>
</ul>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<p>As usual, let’s start with some general imports…</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="nn">regions</span> <span class="kn">import</span> <span class="n">CircleSkyRegion</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataStore</span><span class="p">,</span>
    <span class="n">FixedPointingInfo</span><span class="p">,</span>
    <span class="n">Observation</span><span class="p">,</span>
    <span class="n">observatory_locations</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">gammapy.datasets</span> <span class="kn">import</span> <span class="n">MapDataset</span><span class="p">,</span> <span class="n">MapDatasetEventSampler</span>
<span class="kn">from</span> <span class="nn">gammapy.irf</span> <span class="kn">import</span> <span class="n">load_irf_dict_from_file</span>
<span class="kn">from</span> <span class="nn">gammapy.makers</span> <span class="kn">import</span> <span class="n">MapDatasetMaker</span>
<span class="kn">from</span> <span class="nn">gammapy.maps</span> <span class="kn">import</span> <span class="n">MapAxis</span><span class="p">,</span> <span class="n">WcsGeom</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExpDecayTemporalModel</span><span class="p">,</span>
    <span class="n">FoVBackgroundModel</span><span class="p">,</span>
    <span class="n">Models</span><span class="p">,</span>
    <span class="n">PointSpatialModel</span><span class="p">,</span>
    <span class="n">PowerLawNormSpectralModel</span><span class="p">,</span>
    <span class="n">PowerLawSpectralModel</span><span class="p">,</span>
    <span class="n">SkyModel</span><span class="p">,</span>
    <span class="n">TemplateSpatialModel</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-setup">
<h2>Check setup<a class="headerlink" href="#check-setup" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.utils.check</span> <span class="kn">import</span> <span class="n">check_tutorials_setup</span>

<span class="n">check_tutorials_setup</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>System:

        python_executable      : /home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/bin/python
        python_version         : 3.9.18
        machine                : x86_64
        system                 : Linux


Gammapy package:

        version                : 1.2.dev2111+g5675db08b.d20240402
        path                   : /home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/gammapy


Other packages:

        numpy                  : 1.26.4
        scipy                  : 1.12.0
        astropy                : 5.2.2
        regions                : 0.8
        click                  : 8.1.7
        yaml                   : 6.0.1
        IPython                : 8.18.1
        jupyterlab             : not installed
        matplotlib             : 3.8.3
        pandas                 : not installed
        healpy                 : 1.16.6
        iminuit                : 2.25.2
        sherpa                 : 4.16.0
        naima                  : 0.10.0
        emcee                  : 3.1.4
        corner                 : 2.2.2
        ray                    : 2.10.0


Gammapy environment variables:

        GAMMAPY_DATA           : ./gammapy-data
</pre></div>
</div>
</section>
<section id="define-an-observation">
<h2>Define an Observation<a class="headerlink" href="#define-an-observation" title="Link to this heading">#</a></h2>
<p>You can firstly create a <a class="reference internal" href="../../api/gammapy.data.Observations.html#gammapy.data.Observations" title="gammapy.data.Observations"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Observations</span></code></a> object that
contains the pointing position, the GTIs and the IRF you want to
consider.</p>
<p>Hereafter, we chose the IRF of the South configuration used for the CTA
DC1 and we set the pointing position of the simulated field at the
Galactic Center. We also fix the exposure time to 1 hr.</p>
<p>Let’s start with some initial settings:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;$GAMMAPY_DATA/cta-caldb&quot;</span><span class="p">)</span>
<span class="n">irf_filename</span> <span class="o">=</span> <span class="s2">&quot;Prod5-South-20deg-AverageAz-14MSTs37SSTs.180000s-v0.1.fits.gz&quot;</span>

<span class="c1"># telescope is pointing at a fixed position in ICRS for the observation</span>
<span class="n">pointing</span> <span class="o">=</span> <span class="n">FixedPointingInfo</span><span class="p">(</span>
    <span class="n">fixed_icrs</span><span class="o">=</span><span class="n">SkyCoord</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">icrs</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">livetime</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span>
<span class="n">location</span> <span class="o">=</span> <span class="n">observatory_locations</span><span class="p">[</span><span class="s2">&quot;cta_south&quot;</span><span class="p">]</span>


<span class="n">irfs</span> <span class="o">=</span> <span class="n">load_irf_dict_from_file</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="n">irf_filename</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-pytb notranslate"><div class="highlight"><pre><span></span><span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/examples/tutorials/analysis-3d/event_sampling.py&quot;</span>, line <span class="m">147</span>, in <span class="n">&lt;module&gt;</span>
<span class="w">    </span><span class="n">irfs</span> <span class="o">=</span> <span class="n">load_irf_dict_from_file</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="n">irf_filename</span><span class="p">)</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/gammapy/irf/io.py&quot;</span>, line <span class="m">197</span>, in <span class="n">load_irf_dict_from_file</span>
<span class="w">    </span><span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/hdu/hdulist.py&quot;</span>, line <span class="m">214</span>, in <span class="n">fitsopen</span>
<span class="w">    </span><span class="k">return</span> <span class="n">HDUList</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/hdu/hdulist.py&quot;</span>, line <span class="m">482</span>, in <span class="n">fromfile</span>
<span class="w">    </span><span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_readfrom</span><span class="p">(</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/hdu/hdulist.py&quot;</span>, line <span class="m">1170</span>, in <span class="n">_readfrom</span>
<span class="w">    </span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">_File</span><span class="p">(</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/file.py&quot;</span>, line <span class="m">218</span>, in <span class="n">__init__</span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">_open_filename</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span>
  File <span class="nb">&quot;/home/hstapel/PycharmProjects/projekt_gammapy/gammapy/.tox/build_docs/lib/python3.9/site-packages/astropy/io/fits/file.py&quot;</span>, line <span class="m">636</span>, in <span class="n">_open_filename</span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">IO_FITS_MODES</span><span class="p">[</span><span class="n">mode</span><span class="p">])</span>
<span class="gr">FileNotFoundError</span>: <span class="n">[Errno 2] Aucun fichier ou dossier de ce type: &#39;gammapy-data/cta-caldb/Prod5-South-20deg-AverageAz-14MSTs37SSTs.180000s-v0.1.fits.gz&#39;</span>
</pre></div>
</div>
<p>Now you can create the observation:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">observation</span> <span class="o">=</span> <span class="n">Observation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">obs_id</span><span class="o">=</span><span class="mi">1001</span><span class="p">,</span>
    <span class="n">pointing</span><span class="o">=</span><span class="n">pointing</span><span class="p">,</span>
    <span class="n">livetime</span><span class="o">=</span><span class="n">livetime</span><span class="p">,</span>
    <span class="n">irfs</span><span class="o">=</span><span class="n">irfs</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="define-the-mapdataset">
<h2>Define the MapDataset<a class="headerlink" href="#define-the-mapdataset" title="Link to this heading">#</a></h2>
<p>Let’s generate the <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> object (for more info
on <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> objects, please checkout
<a class="reference internal" href="../api/datasets.html"><span class="doc">Datasets - Reduced data, IRFs, models</span></a> tutorial):
we define the energy axes (true and reconstructed), the migration axis
and the geometry of the observation.</p>
<p><em>This is a crucial point for the correct configuration of the event
sampler. Indeed, the spatial and energetic binning should be treated
carefully and… the finer the better. For this reason, we suggest to
define the energy axes (true and reconstructed) by setting a minimum
binning of least 10-20 bins per decade for all the sources of interest.
The spatial binning may instead be different from source to source and,
at first order, it should be adopted a binning significantly smaller
than the expected source size.</em></p>
<p>For the examples that will be shown hereafter, we set the geometry of
the dataset to a field of view of 2degx2deg and we bin the spatial map
with pixels of 0.02 deg.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_energy_bounds</span><span class="p">(</span><span class="s2">&quot;0.1 TeV&quot;</span><span class="p">,</span> <span class="s2">&quot;100 TeV&quot;</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">per_decade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">energy_axis_true</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_energy_bounds</span><span class="p">(</span>
    <span class="s2">&quot;0.03 TeV&quot;</span><span class="p">,</span> <span class="s2">&quot;300 TeV&quot;</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">per_decade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_true&quot;</span>
<span class="p">)</span>
<span class="n">migra_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">node_type</span><span class="o">=</span><span class="s2">&quot;edges&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;migra&quot;</span><span class="p">)</span>

<span class="n">geom</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">skydir</span><span class="o">=</span><span class="n">pointing</span><span class="o">.</span><span class="n">fixed_icrs</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In the following, the dataset is created by selecting the effective
area, background model, the PSF and the Edisp from the IRF. The dataset
thus produced can be saved into a FITS file just using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">write()</span></code>
function. We put it into the <code class="xref py py-obj docutils literal notranslate"><span class="pre">evt_sampling</span></code> sub-folder:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">empty</span> <span class="o">=</span> <span class="n">MapDataset</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">geom</span><span class="p">,</span>
    <span class="n">energy_axis_true</span><span class="o">=</span><span class="n">energy_axis_true</span><span class="p">,</span>
    <span class="n">migra_axis</span><span class="o">=</span><span class="n">migra_axis</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-dataset&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">maker</span> <span class="o">=</span> <span class="n">MapDatasetMaker</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;psf&quot;</span><span class="p">,</span> <span class="s2">&quot;edisp&quot;</span><span class="p">])</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">maker</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>

<span class="n">Path</span><span class="p">(</span><span class="s2">&quot;event_sampling&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;./event_sampling/dataset.fits&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="define-the-sky-model-a-point-like-source">
<h2>Define the Sky model: a point-like source<a class="headerlink" href="#define-the-sky-model-a-point-like-source" title="Link to this heading">#</a></h2>
<p>Now let’s define a sky model for a point-like source centered 0.5
deg far from the Galactic Center and with a power-law spectrum. We then
save the model into a yaml file.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">spectral_model_pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="s2">&quot;1e-12 TeV-1 cm-2 s-1&quot;</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;1 TeV&quot;</span>
<span class="p">)</span>
<span class="n">spatial_model_point</span> <span class="o">=</span> <span class="n">PointSpatialModel</span><span class="p">(</span>
    <span class="n">lon_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="s2">&quot;0.5 deg&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span>
<span class="p">)</span>

<span class="n">sky_model_pntpwl</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span>
    <span class="n">spectral_model</span><span class="o">=</span><span class="n">spectral_model_pwl</span><span class="p">,</span>
    <span class="n">spatial_model</span><span class="o">=</span><span class="n">spatial_model_point</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;point-pwl&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">bkg_model</span> <span class="o">=</span> <span class="n">FoVBackgroundModel</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;my-dataset&quot;</span><span class="p">)</span>

<span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">([</span><span class="n">sky_model_pntpwl</span><span class="p">,</span> <span class="n">bkg_model</span><span class="p">])</span>

<span class="n">file_model</span> <span class="o">=</span> <span class="s2">&quot;./event_sampling/point-pwl.yaml&quot;</span>
<span class="n">models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_model</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="sampling-the-source-and-background-events">
<h2>Sampling the source and background events<a class="headerlink" href="#sampling-the-source-and-background-events" title="Link to this heading">#</a></h2>
<p>Now, we can finally add the <a class="reference internal" href="../../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel" title="gammapy.modeling.models.SkyModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyModel</span></code></a> we
want to event-sample to the <a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> container:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">models</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
<p>The next step shows how to sample the events with the
<a class="reference internal" href="../../api/gammapy.datasets.MapDatasetEventSampler.html#gammapy.datasets.MapDatasetEventSampler" title="gammapy.datasets.MapDatasetEventSampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatasetEventSampler</span></code></a> class. The class requests a
random number seed generator (that we set with <code class="xref py py-obj docutils literal notranslate"><span class="pre">random_state=0</span></code>), the
<a class="reference internal" href="../../api/gammapy.datasets.Dataset.html#gammapy.datasets.Dataset" title="gammapy.datasets.Dataset"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Dataset</span></code></a> and the <a class="reference internal" href="../../api/gammapy.data.Observations.html#gammapy.data.Observations" title="gammapy.data.Observations"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Observations</span></code></a>
object. From the latter, the
<a class="reference internal" href="../../api/gammapy.datasets.MapDatasetEventSampler.html#gammapy.datasets.MapDatasetEventSampler" title="gammapy.datasets.MapDatasetEventSampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatasetEventSampler</span></code></a> class takes all the meta
data information.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">MapDatasetEventSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of the event-sampler is an event list with coordinates,
energies (true and reconstructed) and time of arrivals of the source and
background events. <code class="xref py py-obj docutils literal notranslate"><span class="pre">events</span></code> is a <a class="reference internal" href="../../api/gammapy.data.EventList.html#gammapy.data.EventList" title="gammapy.data.EventList"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EventList</span></code></a> object
(for details see e.g. <a class="reference internal" href="../data/cta.html"><span class="doc">CTA with Gammapy</span></a> tutorial.).
Source and background events are flagged by the MC_ID identifier (where
0 is the default identifier for the background).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source events: </span><span class="si">{</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;MC_ID&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Background events: </span><span class="si">{</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;MC_ID&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can inspect the properties of the simulated events as follows:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">events</span><span class="o">.</span><span class="n">select_offset</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>By default, the <a class="reference internal" href="../../api/gammapy.datasets.MapDatasetEventSampler.html#gammapy.datasets.MapDatasetEventSampler" title="gammapy.datasets.MapDatasetEventSampler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MapDatasetEventSampler</span></code></a> fills the
metadata keyword <code class="xref py py-obj docutils literal notranslate"><span class="pre">OBJECT</span></code> in the event list using the first model of
the SkyModel object. You can change it with the following commands:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>Let’s write the event list and its GTI extension to a FITS file. We make
use of <code class="xref py py-obj docutils literal notranslate"><span class="pre">fits</span></code> library in <code class="xref py py-obj docutils literal notranslate"><span class="pre">astropy</span></code>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">primary_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">()</span>
<span class="n">hdu_evt</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
<span class="n">hdu_gti</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">gti</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GTI&quot;</span><span class="p">)</span>
<span class="n">hdu_all</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">primary_hdu</span><span class="p">,</span> <span class="n">hdu_evt</span><span class="p">,</span> <span class="n">hdu_gti</span><span class="p">])</span>
<span class="n">hdu_all</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s2">&quot;./event_sampling/events_0001.fits&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="time-variable-source-using-a-lightcurve">
<h2>Time variable source using a lightcurve<a class="headerlink" href="#time-variable-source-using-a-lightcurve" title="Link to this heading">#</a></h2>
<p>The event sampler can also handle temporal variability of the simulated
sources. In this example, we show how to sample a source characterized
by an exponential decay, with decay time of 2800 seconds, during the
observation.</p>
<p>First of all, let’s create a lightcurve:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="mi">2800</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="n">t_ref</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-01-01T00:01:04.184&quot;</span><span class="p">)</span>

<span class="n">times</span> <span class="o">=</span> <span class="n">t_ref</span> <span class="o">+</span> <span class="n">livetime</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">expdecay_model</span> <span class="o">=</span> <span class="n">ExpDecayTemporalModel</span><span class="p">(</span><span class="n">t_ref</span><span class="o">=</span><span class="n">t_ref</span><span class="o">.</span><span class="n">mjd</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">)</span>
</pre></div>
</div>
<p>where we defined the time axis starting from the reference time
<code class="xref py py-obj docutils literal notranslate"><span class="pre">t_ref</span></code> up to the requested exposure (<code class="xref py py-obj docutils literal notranslate"><span class="pre">livetime</span></code>). The bin size of
the time-axis is quite arbitrary but, as above for spatial and energy
binning, the finer the better.</p>
<p>Then, we can create the sky model. Just for the sake of the example,
let’s boost the flux of the simulated source of an order of magnitude:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">spectral_model_pwl</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">2e-11</span>

<span class="n">sky_model_pntpwl</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span>
    <span class="n">spectral_model</span><span class="o">=</span><span class="n">spectral_model_pwl</span><span class="p">,</span>
    <span class="n">spatial_model</span><span class="o">=</span><span class="n">spatial_model_point</span><span class="p">,</span>
    <span class="n">temporal_model</span><span class="o">=</span><span class="n">expdecay_model</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;point-pwl&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">bkg_model</span> <span class="o">=</span> <span class="n">FoVBackgroundModel</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;my-dataset&quot;</span><span class="p">)</span>

<span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">([</span><span class="n">sky_model_pntpwl</span><span class="p">,</span> <span class="n">bkg_model</span><span class="p">])</span>

<span class="n">file_model</span> <span class="o">=</span> <span class="s2">&quot;./event_sampling/point-pwl_decay.yaml&quot;</span>
<span class="n">models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_model</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>For simplicity, we use the same dataset defined for the previous
example:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">models</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
<p>And now, let’s simulate the variable source:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">MapDatasetEventSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source events: </span><span class="si">{</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;MC_ID&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Background events: </span><span class="si">{</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;MC_ID&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now inspect the properties of the simulated source. To do that,
we adopt the <code class="xref py py-obj docutils literal notranslate"><span class="pre">select_region</span></code> function that extracts only the events
into a given <code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyRegion</span></code> of a <a class="reference internal" href="../../api/gammapy.data.EventList.html#gammapy.data.EventList" title="gammapy.data.EventList"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EventList</span></code></a> object:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">src_position</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>

<span class="n">on_region_radius</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;0.15 deg&quot;</span><span class="p">)</span>
<span class="n">on_region</span> <span class="o">=</span> <span class="n">CircleSkyRegion</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">src_position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">on_region_radius</span><span class="p">)</span>

<span class="n">src_events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">select_region</span><span class="p">(</span><span class="n">on_region</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we can have a quick look to the data with the <code class="xref py py-obj docutils literal notranslate"><span class="pre">peek</span></code> function:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">src_events</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>In the right figure of the bottom panel, it is shown the source
lightcurve that follows a decay trend as expected.</p>
</section>
<section id="extended-source-using-a-template">
<h2>Extended source using a template<a class="headerlink" href="#extended-source-using-a-template" title="Link to this heading">#</a></h2>
<p>The event sampler can also work with a template model. Here we use the
interstellar emission model map of the Fermi 3FHL, which can be found in
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">$GAMMAPY_DATA</span></code> repository.</p>
<p>We proceed following the same steps showed above and we finally have a
look at the event’s properties:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">template_model</span> <span class="o">=</span> <span class="n">TemplateSpatialModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/gll_iem_v06_gc.fits.gz&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="c1"># we make the model brighter artificially so that it becomes visible over the background</span>
<span class="n">diffuse</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span>
    <span class="n">spectral_model</span><span class="o">=</span><span class="n">PowerLawNormSpectralModel</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">spatial_model</span><span class="o">=</span><span class="n">template_model</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;template-model&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">bkg_model</span> <span class="o">=</span> <span class="n">FoVBackgroundModel</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;my-dataset&quot;</span><span class="p">)</span>

<span class="n">models_diffuse</span> <span class="o">=</span> <span class="n">Models</span><span class="p">([</span><span class="n">diffuse</span><span class="p">,</span> <span class="n">bkg_model</span><span class="p">])</span>

<span class="n">file_model</span> <span class="o">=</span> <span class="s2">&quot;./event_sampling/diffuse.yaml&quot;</span>
<span class="n">models_diffuse</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_model</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">models_diffuse</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">MapDatasetEventSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>

<span class="n">events</span><span class="o">.</span><span class="n">select_offset</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="simulate-multiple-event-lists">
<h2>Simulate multiple event lists<a class="headerlink" href="#simulate-multiple-event-lists" title="Link to this heading">#</a></h2>
<p>In some user case, you may want to sample events from a number of
observations. In this section, we show how to simulate a set of event
lists. For simplicity, we consider only one point-like source, observed
three times for 1 hr and assuming the same pointing position.</p>
<p>Let’s firstly define the time start and the livetime of each
observation:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">tstarts</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2020-01-01 00:00:00&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span>
<span class="n">livetimes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">n_obs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tstarts</span><span class="p">)</span>
<span class="n">irf_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="o">/</span> <span class="n">irf_filename</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_obs</span>
<span class="n">events_paths</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">tstart</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tstarts</span><span class="p">):</span>
    <span class="n">irfs</span> <span class="o">=</span> <span class="n">load_irf_dict_from_file</span><span class="p">(</span><span class="n">irf_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">observation</span> <span class="o">=</span> <span class="n">Observation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">obs_id</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
        <span class="n">pointing</span><span class="o">=</span><span class="n">pointing</span><span class="p">,</span>
        <span class="n">tstart</span><span class="o">=</span><span class="n">tstart</span><span class="p">,</span>
        <span class="n">livetime</span><span class="o">=</span><span class="n">livetimes</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
        <span class="n">irfs</span><span class="o">=</span><span class="n">irfs</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">maker</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">models</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">MapDatasetEventSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./event_sampling/events_</span><span class="si">{</span><span class="n">idx</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">.fits&quot;</span><span class="p">)</span>
    <span class="n">events_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">events</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now load the event list and the corresponding IRFs with
<code class="xref py py-obj docutils literal notranslate"><span class="pre">DataStore.from_events_files</span></code>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./event_sampling/&quot;</span><span class="p">)</span>
<span class="n">events_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;events*.fits&quot;</span><span class="p">))</span>
<span class="n">data_store</span> <span class="o">=</span> <span class="n">DataStore</span><span class="o">.</span><span class="n">from_events_files</span><span class="p">(</span><span class="n">events_paths</span><span class="p">,</span> <span class="n">irf_paths</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">data_store</span><span class="o">.</span><span class="n">obs_table</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you can create the observations from the data store and make your own
analysis following the instructions in the
<a class="reference internal" href="../starting/analysis_2.html"><span class="doc">Low level API</span></a> tutorial.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">observations</span> <span class="o">=</span> <span class="n">data_store</span><span class="o">.</span><span class="n">get_observations</span><span class="p">()</span>
<span class="n">observations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Try to sample events for an extended source (e.g. a radial gaussian
morphology);</p></li>
<li><p>Change the spatial model and the spectrum of the simulated Sky model;</p></li>
<li><p>Include a temporal model in the simulation</p></li>
</ul>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-analysis-3d-event-sampling-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/master?urlpath=lab/tree/notebooks/dev/tutorials/analysis-3d/event_sampling.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo2.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/1369ed1d3d840a1191c042bbaa5b822e/event_sampling.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">event_sampling.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/2f08c23d5b7b7c5f88a32069855d273f/event_sampling.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">event_sampling.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#context">Context</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objective">Objective</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposed-approach">Proposed approach</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-setup">Check setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-an-observation">Define an Observation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-mapdataset">Define the MapDataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-sky-model-a-point-like-source">Define the Sky model: a point-like source</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-the-source-and-background-events">Sampling the source and background events</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-variable-source-using-a-lightcurve">Time variable source using a lightcurve</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extended-source-using-a-template">Extended source using a template</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-multiple-event-lists">Simulate multiple event lists</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/tutorials/analysis-3d/event_sampling.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, The Gammapy developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>